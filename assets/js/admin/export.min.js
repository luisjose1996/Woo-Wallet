!function(c,u){var e=function(e){this.$form=e,this.xhr=!1,this.$form.find(".terawallet-exporter-progress").val(0),this.processStep=this.processStep.bind(this),e.on("submit",{teraWalletExportForm:this},this.onSubmit),this.$form.find(".terawallet-exporter-type").on("change",{teraWalletExportForm:this},this.onChangeType).change()};e.prototype.onSubmit=function(e){e.preventDefault();var t=new Date,t="terawallet-transaction-export-"+t.getDate()+"-"+(t.getMonth()+1)+"-"+t.getFullYear()+"-"+t.getTime()+".csv";e.data.teraWalletExportForm.$form.addClass("terawallet-exporter__exporting"),e.data.teraWalletExportForm.$form.find(".terawallet-exporter-progress").val(0),e.data.teraWalletExportForm.$form.find(".terawallet-exporter-button").prop("disabled",!0),e.data.teraWalletExportForm.processStep(1,c(this).serialize(),"",t)},e.prototype.onChangeType=function(){c(this).is(":checked")?c(".export-transaction-settings-fields").hide():c(".export-transaction-settings-fields").show()},e.prototype.processStep=function(e,t,r,a){var o=this,l=c(".terawallet-exporter-type").is(":checked")?"balance":"transactions",n=c(".terawallet-exporter-columns").val(),s=c(".terawallet-exporter-users").val(),p=c(".terawallet-exporter-from-date").val(),i=c(".terawallet-exporter-to-date").val();c.ajax({type:"POST",url:ajaxurl,data:{form:t,action:"terawallet_do_ajax_transaction_export",step:e,export_type:l,columns:r,selected_columns:n,selected_users:s,start_date:p,end_date:i,filename:a,security:terawallet_export_params.export_nonce},dataType:"json",success:function(e){e.success&&("done"===e.data.step?(o.$form.find(".terawallet-exporter-progress").val(e.data.percentage),u.location=e.data.url,setTimeout(function(){o.$form.removeClass("terawallet-exporter__exporting"),o.$form.find(".terawallet-exporter-button").prop("disabled",!1)},200)):(o.$form.find(".terawallet-exporter-progress").val(e.data.percentage),o.processStep(parseInt(e.data.step,10),t,e.data.columns,a)))}}).fail(function(e){u.console.log(e)})},c.fn.terawallet_export_form=function(){return new e(this),this},c(".terawallet-exporter").terawallet_export_form(),c(".terawallet-exporter-users").selectWoo({language:{inputTooShort:function(){return terawallet_export_params.i18n.inputTooShort},noResults:function(){return terawallet_export_params.i18n.no_resualt},searching:function(){return terawallet_export_params.i18n.searching}},minimumInputLength:3,ajax:{url:ajaxurl,dataType:"json",type:"POST",delay:250,data:function(e){return{action:"terawallet_export_user_search",security:terawallet_export_params.search_user_nonce,autocomplete_field:"ID",term:e.term}},processResults:function(e){return{results:c.map(e,function(e){return{id:e.value,text:e.label}})}}}})}(jQuery,window);