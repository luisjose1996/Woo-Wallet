!function(i,u){var t=function(t){this.$form=t,this.xhr=!1,this.$form.find(".terawallet-exporter-progress").val(0),this.processStep=this.processStep.bind(this),t.on("submit",{teraWalletExportForm:this},this.onSubmit)};t.prototype.onSubmit=function(t){t.preventDefault();var e=new Date,r="terawallet-transaction-export-"+e.getDate()+"-"+(e.getMonth()+1)+"-"+e.getFullYear()+"-"+e.getTime()+".csv";t.data.teraWalletExportForm.$form.addClass("terawallet-exporter__exporting"),t.data.teraWalletExportForm.$form.find(".terawallet-exporter-progress").val(0),t.data.teraWalletExportForm.$form.find(".terawallet-exporter-button").prop("disabled",!0),t.data.teraWalletExportForm.processStep(1,i(this).serialize(),"",r)},t.prototype.processStep=function(t,e,r,a){var o=this,l=i(".terawallet-exporter-columns").val(),n=i(".terawallet-exporter-users").val(),s=i(".terawallet-exporter-from-date").val(),p=i(".terawallet-exporter-to-date").val();i.ajax({type:"POST",url:ajaxurl,data:{form:e,action:"terawallet_do_ajax_transaction_export",step:t,columns:r,selected_columns:l,selected_users:n,start_date:s,end_date:p,filename:a,security:terawallet_export_params.export_nonce},dataType:"json",success:function(t){t.success&&("done"===t.data.step?(o.$form.find(".terawallet-exporter-progress").val(t.data.percentage),u.location=t.data.url,setTimeout(function(){o.$form.removeClass("terawallet-exporter__exporting"),o.$form.find(".terawallet-exporter-button").prop("disabled",!1)},200)):(o.$form.find(".terawallet-exporter-progress").val(t.data.percentage),o.processStep(parseInt(t.data.step,10),e,t.data.columns,a)))}}).fail(function(t){u.console.log(t)})},i.fn.terawallet_export_form=function(){return new t(this),this},i(".terawallet-exporter").terawallet_export_form(),i(".terawallet-exporter-users").selectWoo({language:{inputTooShort:function(){return terawallet_export_params.i18n.inputTooShort},noResults:function(){return terawallet_export_params.i18n.no_resualt},searching:function(){return terawallet_export_params.i18n.searching}},minimumInputLength:3,ajax:{url:ajaxurl,dataType:"json",type:"POST",delay:250,data:function(t){return{action:"terawallet_export_user_search",security:terawallet_export_params.search_user_nonce,autocomplete_field:"ID",term:t.term}},processResults:function(t){return{results:i.map(t,function(t){return{id:t.value,text:t.label}})}}}})}(jQuery,window);